<div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
    <button type="button" class="btn btn-success" (click)="onClickAddNew()">جدید</button>
</div>

<div class="mb-3">
    <app-alert *ngIf="isLoading" AlertType="Download" TextMessage="در حال واکشی اطلاعات ..."></app-alert>
    <app-alert *ngIf="error?.message" [AlertType]="'Error'" [TextMessage]="'خطا در واکشی اطلاعات'"></app-alert>
    <app-alert *ngFor="let errorMessage of errorMessages" [AlertType]="'Error'" [TextMessage]="errorMessage"></app-alert>
    <app-alert *ngIf="users?.length == 0 && !isLoading" AlertType="Info" TextMessage="اطلاعاتی برای نمایش وجود ندارد"></app-alert>
    <app-alert *ngIf="formSuccessful" [AlertType]="'Success'" [TextMessage]="'اطلاعات با موفقیت ثبت گردید'"></app-alert>
</div>

<div class="table-responsive" *ngIf="users?.length">
    <table class="table table-hover table-sm bg-white align-middle">
        <thead class="bg-secondary text-light">
            <tr>
                <th scope="col">تصویر</th>
                <th scope="col">نام</th>
                <th scope="col">نام کاربری</th>
                <th scope="col">نقش</th>
                <th scope="col">وضعیت</th>
                <th scope="col">فروشگاه‌ها</th>
                <th scope="col" class="text-end">عملیات</th>
            </tr>
        </thead>
        <tbody>
            @for (user of users; track user.id) {
            <tr>
                <td>
                    <img *ngIf="!user.avatar" src="assets/images/noavatar.png" class="table-avatar" alt="User avatar">
                    <img *ngIf="user.avatar" [src]="user.avatar.url" class="table-avatar" alt="User avatar">
                </td>
                <td class="fw-semibold">{{ user.fullName }}</td>
                <td><span class="badge bg-light text-dark border">{{ user.userName }}</span></td>
                <td><span class="badge bg-primary">{{ user.role.name }}</span></td>
                <td>
                    <span [ngClass]="{'bg-success': user.isActive , 'bg-danger' : !user.isActive}"
                        class="badge">{{ user.isActive | active}} </span>
                </td>
                <td>
                    <div class="d-flex flex-wrap gap-1">
                        @for (store of user.stores; track store.id) {
                        <span class="badge bg-light text-dark border">{{store.name}}</span>
                        }
                    </div>
                </td>
                <td class="text-end">
                    <div ngbDropdown class="d-inline-block">
                        <button class="btn btn-secondary btn-sm" [id]="'userActions' + user.id" ngbDropdownToggle>عملیات</button>
                        <div ngbDropdownMenu [attr.aria-labelledby]="'userActions' + user.id">
                            <button ngbDropdownItem class="dropdown-item"
                                (click)="viewUserProfile(user)">پروفایل</button>
                            <button ngbDropdownItem class="dropdown-item" (click)="onClickEdit(user)">ویرایش</button>
                            <button ngbDropdownItem class="dropdown-item" (click)="onClickDelete(user)">حذف</button>
                            <button ngbDropdownItem class="dropdown-item" (click)="onClickForceChangePassword(user)">اجبار به تغییر رمز</button>
                            <button ngbDropdownItem class="dropdown-item" (click)="activationToggle(user)">
                                فعال/غیر فعال
                            </button>
                        </div>
                    </div>
                </td>
            </tr>
            }
        </tbody>
    </table>
</div>
